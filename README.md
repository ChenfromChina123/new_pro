# AI智能学习助手系统 - Vue 3版本

这是基于Vue 3的现代化前端重构版本，将原有的HTML页面转换为组件化的Vue应用。

## ✨ 特性

- 🚀 **Vue 3 + Vite** - 使用最新的Vue 3 Composition API和Vite构建工具
- 🎨 **现代化UI** - 全新的界面设计，支持深色模式
- 📦 **组件化开发** - 模块化的组件结构，易于维护和扩展
- 🔐 **完整的认证系统** - JWT Token认证，路由守卫
- 💾 **状态管理** - 使用Pinia进行全局状态管理
- 🌐 **API集成** - 完整对接后端FastAPI接口
- 📱 **响应式设计** - 适配各种屏幕尺寸

## 🛠️ 技术栈

- **框架**: Vue 3.4+
- **构建工具**: Vite 5.0+
- **路由**: Vue Router 4.2+
- **状态管理**: Pinia 2.1+
- **HTTP客户端**: Axios 1.6+
- **Markdown渲染**: Marked 11.0+
- **代码高亮**: Highlight.js 11.9+

## 📦 安装

### 前置要求

- Node.js 16+ 或 20+
- npm 或 yarn

### 安装步骤

1. **克隆项目**

```bash
cd Aiproject8.2/vue-app
```

2. **安装依赖**

```bash
npm install
# 或
yarn install
```

3. **配置环境变量**

项目会自动使用代理将 `/api` 请求转发到 `http://localhost:5000`

如需修改后端地址，可编辑 `vite.config.js`:

```javascript
server: {
  port: 3000,
  proxy: {
    '/api': {
      target: 'http://your-backend-url:5000',
      changeOrigin: true
    }
  }
}
```

## 🚀 运行

### 最近更新
- **全屏布局重构**:
  - 将聊天界面重构为 100vh 全屏布局，移除了原有容器的最大宽度限制和圆角阴影，使视野更开阔。
  - 侧边栏改为固定宽度并占据整个屏幕高度，实现了真正的全屏 AI 交互体验。
- **侧边栏用户信息集成**:
  - 在侧边栏顶部集成了用户头像和用户名，支持自动获取和展示用户头像。
  - 在侧边栏顶部添加了主题切换按钮，方便用户一键切换深色/浅色模式。
  - 在侧边栏底部添加了“退出登录”按钮，提升了账户管理的便捷性。
- **输入框 UI 全面重构**:
  - 采用了更大圆角的现代化输入区域设计，增加了底部工具栏。
  - 引入了丰富的操作图标：附件上传、深度思考切换、技能选择、截图、语音通话及语音输入。
  - 实现了输入框高度随内容自动撑开（最大 200px）的丝滑体验。
- **新增停止生成功能**:
  - 在 AI 输出过程中，发送按钮自动切换为“停止”按钮（圆圈内嵌正方形图标）。
  - 支持通过 AbortController 中止 SSE 流式输出，并自动保存已生成的部分内容。
- **深度思考快捷切换**: 
  - 输入框左侧新增“深度思考”专用按钮，支持一键在普通模型与推理模型（如 DeepSeek Reasoner）之间快速切换，并伴有明显的视觉激活状态。
- **聊天界面样式重构 (图 2 风格)**: 
  - 移除了用户头像，将用户消息调整为右对齐的浅灰色气泡，使用深色文字，使界面更加清爽。
  - 优化了 AI 回复的样式，去除了背景色，使内容直接展示在背景上，符合主流 AI 产品的极简风格。
  - 改进了“深度思考”组件的视觉表现，收起时显示“已完成思考”，并采用更柔和的圆角和背景。
- **聊天界面滚动优化**: 修复了点击深度思考（推理）组件切换展开/收起状态时聊天框会自动滚动到底部的问题，现在仅在发送新消息或流式输出内容时自动滚动。
- **深度思考展示逻辑优化**: 实现了推理模型输出时的智能展示逻辑：当正文未输出时思考内容自动展开，当正文开始输出时思考内容自动收起，提升了阅读体验。
- **聊天界面布局优化**: 修复了超长标题覆盖模型选择器的问题，并将聊天内容区域调整为固定宽度的居中布局，对齐主流 AI 产品 UI 风格。
- **UI 细节修复**: 修复了侧边栏“新建对话”按钮在某些主题下字体不可见的问题，通过明确设置高对比度的背景颜色和文字颜色，提升了界面的可用性和视觉清晰度。
- **侧边栏功能中心化与代码清理**:
  - 实现了侧边栏逻辑的统一管理，将 AI 聊天和云盘页面的侧边栏逻辑合并至 `AppSidebar.vue`。
  - 移除了 `ChatView.vue` 和 `CloudDiskView.vue` 中冗余的侧边栏模板、脚本和样式，降低了代码复杂度。
  - 使用 Pinia 存储（`chatStore` 和 `cloudDiskStore`）统一管理侧边栏相关的状态（如对话历史、文件夹树、对话框显隐等）。
  - 优化了云盘页面的响应式布局，移除了重复的移动端侧边栏切换逻辑，改由全局 `AppLayout` 统一处理。
- **全局导航架构重构**:
  - 将全局导航（AI问答、云盘、语言学习、管理）从顶部标题栏迁移至左侧边栏，提升了空间利用率并对齐主流 AI 产品布局。
  - 移除了顶部冗余的模型选择器，将其整合进输入框工具栏。
- **代码质量与安全增强**:
  - 集成了 `DOMPurify` 库对聊天消息进行 XSS 过滤，确保在渲染 AI 生成的 HTML 内容（如公式、代码块）时的安全性。
  - 修复了 `ChatView.vue` 中的 Linter 错误，包括缺失的闭合标签、不一致的缩进等。
  - 为核心组件函数添加了详尽的 JSDoc 注释，提升了代码的可读性和可维护性。
- **聊天数据加载逻辑优化**:
  - 修复了从侧边栏切换对话时内容无法加载的问题，通过在 `ChatView.vue` 中增加对路由参数和会话 ID 的深度监听，确保数据同步加载。
  - 优化了初始进入页面时的会话自动选择逻辑，支持从 URL 参数恢复会话状态。
  - 移除了 AppHeader 中的冗余导航菜单，实现了侧边栏统一导航。
- **输入框工具栏优化**:
  - 将“技能”按钮替换为行内模型选择下拉框，支持在输入过程中快速切换模型，操作更加便捷。
  - 优化了下拉框样式，采用品牌分类（DeepSeek、豆包）设计，移除了冗余图标，界面更加纯净专业。
  - 实现了平滑的展开/收起动画（cubic-bezier），提升了交互的丝滑感。
- **聊天字体与视觉优化**:
  - 调大了聊天消息的字体大小（16px/17px），显著提升了长文本阅读的舒适度。
  - 优化了消息间距和行高，使对话流更加清晰易读。
  - 移除了模型选择器中的装饰性图标，使界面回归极简主义，减少视觉干扰。
- **模型自动切换逻辑**:
  - 实现了深度思考与模型品牌的联动：切换品牌时自动保持当前的深度思考状态（standard/reasoner），开启深度思考时自动切换到对应品牌的推理模型。
- **后端通信增强**: 实现了基于 OkHttp 的流式客户端，支持 reasoning_content（深度思考）参数，并统一了 SSL 验证配置以确保与 Python 端迁移的一致性。
- **聊天头像优化**: DeepSeek 与 豆包使用静态头像资源，用户消息优先使用已上传头像，无头像则自动兜底到原有图标。
- **AI文章单词高亮**: 统一了文章在线预览与下载 HTML 的样式，实现了已选单词在文章中的高亮显示，并支持鼠标悬停查看单词释义。
- **AI文章展示优化**: 进一步优化了文章展示弹窗的页面结构，增加了弹窗宽度至 1200px，优化了关闭按钮的视觉样式与交互位置，使其更加符合现代化 UI 规范。
- **AI文章生成优化**: 修复了文章加载时的 `LazyInitializationException` 延迟加载异常，确保文章词汇关联数据正确加载。
- **文章展示页面重构**: 优化了AI生成文章的展示布局，增加了弹窗宽度，并实现了中英文对照的左右分栏显示，极大提升了阅读体验。
- **公共词库优化**: 修复了公共词库不显示的问题，实现了后端分页加载，添加了加载状态提示。
- **夜间模式适配**: 统一了所有前端模块的样式，特别是语言学习模块，现在完全适配夜间模式。
- **网盘文件夹树优化**: 修复了点击父文件夹会导致子文件夹意外展开的问题，优化了文件夹激活状态的样式显示，并实现了创建新文件夹后的自动刷新和展开逻辑。
- **云盘目录导航修复**: 修复了点击子目录会冒泡触发根目录选择，导致无法进入目录的问题。
- **云盘目录树交互修复**:
  - 修复了文件夹点击、展开和删除功能失效的问题，通过在 `AppSidebar.vue` 中增强参数类型处理（支持对象和 ID），确保递归组件在不同层级下的稳定性。
  - 统一了文件夹属性命名，修正了 `folderName` 与 `name` 的混用问题，确保 UI 显示与后端数据结构一致。
  - 优化了 `FolderTreeItem.vue` 的事件传递机制，修复了删除文件夹时因参数传递错误导致的删除失败问题。
- **云盘 UI 视觉升级 (对齐主流风格)**:
  - **文件夹树优化**: 增大了文件夹展开/收起按钮（三角形）的尺寸和点击区域，提升了操作便利性。
  - **文件列表重构**: 将文件展示从复杂的表格改为极简的列表布局，仅保留“文件名”和“修改时间”核心列。
  - **交互体验提升**: 引入了更清爽的图标设计、更细腻的行高与间距，并实现了整行点击选中、悬停高亮等交互细节。
  - **面包屑与工具栏优化**: 重塑了路径导航与操作按钮布局，移除了冗余的“我的分享”按钮，并将“上传文件”按钮统一为简洁的次级样式（白底黑字），使其更加符合现代化网盘产品的审美与逻辑。
- **网盘上传功能修复**: 修复了上传文件夹时结构错乱及文件未正确保存的问题，现在能够完整保留上传文件夹的层级结构。
- **文件上传冲突处理**: 完善了文件系统重命名机制，新增智能重命名（自动添加序号）与覆盖确认对话框，优化了批量上传时的冲突处理体验。
- **文件夹重命名机制升级**: 实现了与文件一致的文件夹重命名功能，支持智能冲突检测、自动重命名及覆盖合并策略，并自动处理子文件和子文件夹的递归路径更新。

### 开发模式

```bash
npm run dev
```

应用将在 `http://localhost:3000` 启动

### 生产构建

```bash
npm run build
```

构建文件将输出到 `dist` 目录

### 预览生产构建

```bash
npm run preview
```

## 📁 项目结构

```
vue-app/
├── src/
│   ├── assets/              # 静态资源
│   │   └── styles/          # 全局样式
│   │       └── main.css     # 主样式文件
│   ├── components/          # 通用组件
│   │   ├── AppHeader.vue    # 顶部导航栏
│   │   └── AppLayout.vue    # 布局组件
│   ├── config/              # 配置文件
│   │   └── api.js           # API配置和端点
│   ├── router/              # 路由配置
│   │   └── index.js         # 路由定义
│   ├── stores/              # Pinia状态管理
│   │   ├── auth.js          # 认证状态
│   │   ├── chat.js          # 聊天状态
│   │   ├── cloudDisk.js     # 云盘状态
│   │   └── theme.js         # 主题状态
│   ├── utils/               # 工具函数
│   │   └── request.js       # Axios封装
│   ├── views/               # 页面组件
│   │   ├── auth/            # 认证相关页面
│   │   │   ├── LoginView.vue     # 登录页
│   │   │   └── RegisterView.vue  # 注册页
│   │   ├── AdminView.vue         # 管理后台
│   │   ├── ChatManagementView.vue # 聊天记录管理
│   │   ├── ChatView.vue          # AI问答主页
│   │   ├── CloudDiskView.vue     # 云盘管理
│   │   ├── LanguageLearningView.vue # 语言学习
│   │   └── NotFoundView.vue      # 404页面
│   ├── App.vue              # 根组件
│   └── main.js              # 应用入口
├── public/                  # 公共静态资源
├── index.html               # HTML模板
├── package.json             # 项目配置
├── vite.config.js           # Vite配置
└── README.md                # 本文件
```

## 🎯 主要功能

### 1. 用户认证
- ✅ 邮箱注册（含验证码）
- ✅ 用户登录
- ✅ JWT Token认证
- ✅ 路由守卫保护

### 2. AI问答
- ✅ 流式AI回复
- ✅ 会话管理
- ✅ 消息历史
- ✅ 多模型支持（DeepSeek、豆包）
- ✅ Markdown渲染
- ✅ 代码高亮

### 3. 云盘管理
- ✅ 文件上传（支持多文件）
- ✅ 文件夹管理
- ✅ 文件预览
- ✅ 批量下载
- ✅ 批量删除
- ✅ 上传进度显示

### 4. 语言学习
- ✅ 企业级侧边栏布局，支持固定高度和内部滚动
- ✅ 单词表管理（创建、删除、统计）
- ✅ 单词添加和学习（支持掌握度分级）
- ✅ 学习时长统计（今日时长/总时长）
- ✅ 今日复习支持“认识/掌握”快速更新进度
- ✅ 公共词库默认加载前50条，分页按需加载
- ✅ 独立视图的 AI 学习文章生成（支持选择来源词表）

### 5. 聊天记录管理
- ✅ 查看所有对话
- ✅ 删除对话
- ✅ 快速跳转到会话

### 6. 管理后台（需要管理员权限）
- ✅ 用户管理
- ✅ 文件管理
- ✅ 反馈管理
- ✅ 数据统计

### 7. 其他功能
- ✅ 深色模式切换
- ✅ 响应式设计
- ✅ 动画效果
- ✅ 路由过渡

## 🔌 API对接

所有API端点配置在 `src/config/api.js` 中：

```javascript
export const API_ENDPOINTS = {
  auth: { ... },      // 认证相关
  chat: { ... },      // AI问答
  cloudDisk: { ... }, // 云盘管理
  language: { ... },  // 语言学习
  admin: { ... }      // 管理后台
}
```

### HTTP拦截器

- **请求拦截器**: 自动添加JWT Token到请求头
- **响应拦截器**: 统一处理错误，401自动跳转登录

## 🎨 样式定制

### CSS变量

所有主题颜色定义在 `src/assets/styles/main.css` 中的CSS变量：

```css
:root {
  --primary-color: #3498db;
  --secondary-color: #2980b9;
  --success-color: #27ae60;
  /* ... 更多变量 */
}

body.dark-mode {
  /* 深色模式变量 */
}
```

### 深色模式

使用Pinia store管理主题：

```javascript
import { useThemeStore } from '@/stores/theme'

const themeStore = useThemeStore()
themeStore.toggleDarkMode() // 切换主题
```

## 🔒 路由守卫

路由守卫配置在 `src/router/index.js` 中：

- `requiresAuth`: 需要登录才能访问
- `requiresGuest`: 只有未登录用户可访问（如登录、注册页）
- `requiresAdmin`: 需要管理员权限

## 📱 响应式设计

- 桌面端: 完整功能，侧边栏布局
- 平板: 适配中等屏幕
- 移动端: 隐藏侧边栏，优化触摸操作

## 🚀 部署

### 部署到生产环境

1. **构建项目**

```bash
npm run build
```

2. **部署dist目录**

将 `dist` 目录部署到任何静态服务器：

- Nginx
- Apache
- Vercel
- Netlify
- GitHub Pages

### Nginx配置示例

```nginx
server {
    listen 80;
    server_name your-domain.com;
    root /path/to/dist;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    location /api {
        proxy_pass http://localhost:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## 🔧 开发指南

### 添加新页面

1. 在 `src/views/` 创建新的Vue组件
2. 在 `src/router/index.js` 添加路由
3. 在 `src/components/AppHeader.vue` 添加导航链接

### 添加新的API

1. 在 `src/config/api.js` 添加API端点
2. 在对应的store或组件中调用

### 添加新的Store

1. 在 `src/stores/` 创建新的store文件
2. 使用Composition API风格定义store
3. 在组件中引入使用

## ❓ 常见问题

### 问: API请求失败，提示网络错误
答: 确保后端服务运行在 `http://localhost:5000`，或修改vite.config.js中的代理配置

### 问: 登录后刷新页面需要重新登录
答: Token已保存在localStorage，检查浏览器控制台是否有错误

### 问: 深色模式不生效
答: 确保已在Pinia store中正确初始化主题

### 问: 文件上传失败
答: 检查后端MAX_FILE_SIZE配置，默认为500MB

## 📝 与原HTML版本的对比

| 特性 | HTML版本 | Vue 3版本 |
|------|---------|-----------|
| 技术栈 | 原生JS | Vue 3 + Vite |
| 代码组织 | 单文件数千行 | 组件化模块化 |
| 状态管理 | 全局变量 | Pinia |
| 路由 | 页面跳转 | Vue Router |
| API调用 | Fetch | Axios + 拦截器 |
| 样式管理 | 内联样式 | CSS变量 + Scoped |
| 开发体验 | 手动刷新 | HMR热更新 |
| 构建优化 | 无 | Vite自动优化 |
| 代码复用 | 复制粘贴 | 组件化复用 |
| 维护性 | 较差 | 优秀 |

## 🤝 贡献

欢迎提交Issue和Pull Request！

## 📄 许可证

MIT License

## 📮 联系方式

如有问题或建议，请提交Issue或联系开发团队。

---

**Made with ❤️ using Vue 3**

最后更新: 2024年12月

