# AI智能学习助手系统 - Vue 3版本

这是基于Vue 3的现代化前端重构版本，将原有的HTML页面转换为组件化的Vue应用。

## ✨ 特性

- 🚀 **Vue 3 + Vite** - 使用最新的Vue 3 Composition API和Vite构建工具
- 🎨 **现代化UI** - 全新的界面设计，支持深色模式
- 📦 **组件化开发** - 模块化的组件结构，易于维护和扩展
- 🔐 **完整的认证系统** - JWT Token认证，路由守卫
- 💾 **状态管理** - 使用Pinia进行全局状态管理
- 🌐 **API集成** - 完整对接后端FastAPI接口
- 📱 **响应式设计** - 适配各种屏幕尺寸

## 🛠️ 技术栈

### 前端
- **框架**: Vue 3.4+
- **构建工具**: Vite 5.0+
- **路由**: Vue Router 4.2+
- **状态管理**: Pinia 2.1+
- **HTTP客户端**: Axios 1.6+
- **Markdown渲染**: Marked 11.0+
- **代码高亮**: Highlight.js 11.9+

### 后端
- **框架**: Spring Boot 3.3.5
- **运行环境**: **Java 17+ (必须)**
- **构建工具**: Maven 3.6+
- **AI 框架**: Spring AI
- **默认端口**: 5000 (请确保此端口未被其他服务占用，如 Python Flask 等)

## 🛠️ 服务启动指南

### 🛠️ 服务启动指南

#### 后端启动 (Spring Boot)
1. 进入 `aispring` 目录
2. 运行 `./mvnw.cmd spring-boot:run` (Windows) 或 `./mvnw spring-boot:run` (Linux/Mac)
3. 确保端口 5000 可用。如果启动失败并提示端口占用，请使用相应平台的命令查找并终止冲突进程（如 Windows 下使用 `netstat -ano | findstr :5000`）。

#### 前端启动 (Vue 3)
1. 进入 `vue-app` 目录
2. 运行 `npm install` (首次启动)
3. 运行 `npm run dev`
4. 默认访问地址: `http://localhost:5173`

##### 🚀 最近更新

### 🛠️ Agent 终端助手 Linux 支持上线 (2026-01-13)
- **顶层组件集成 Linux 介绍**:
  - **Hero 区域重构**: 在 `AgentView.vue` 顶层 Hero 区域直接引入 Linux 支持介绍与快捷下载，并明确标注了 **Windows 全量版** 与 **Linux 独立版**，提升了版本识别度。
  - **跨平台全量包 (v1.0.0)**: 将 Windows 发行版与 Linux 二进制文件集成到统一的 `xiaochen_agent_v1.0.0.zip` 压缩包中，实现一包支持多平台。
  - **视觉体验优化**: 统一了下载按钮的视觉风格，新增了 Windows 平台图标，确保在不同主题下均具备良好的交互反馈。
- **全局导航体验优化**:
  - **返回首页功能**: 在侧边栏顶部操作区域新增了“返回首页”快捷按钮，方便用户在不同功能页与落地页之间快速切换。
- **静态资源更新**:
  - 发布并部署了集成了 Linux 版本的全平台压缩包 `xiaochen_agent_v1.0.0.zip`。

### 🛠️ Agent 专题页与 RequirementManager 视觉对齐 (2026-01-13)
- **视觉风格全站统一**:
  - **色调重构**: 将 `AgentView.vue`、`ChatView.vue` 和 `RequirementManager.vue` 中的旧版蓝紫色调全面替换为现代化的青绿渐变方案 (`#06b6d4` -> `#10b981`)。
  - **深度思考组件优化**: 重构了 `ChatView.vue` 中的深度思考（Reasoning）模块，采用青绿色边框和呼吸灯动画，适配深色模式。
  - **RequirementManager 升级**: 为需求管理组件引入了与 `AgentView` 一致的侧边栏风格、渐变按钮及深色模式适配。
- **布局与交互优化**:
  - **移动端适配**: 统一了移动端菜单的间距、圆角与 Z-index 层级。
  - **页脚对齐**: 将 `LandingView` 的页脚样式同步至 `AgentView`，并优化了其在深色模式下的表现。
- **代码质量**: 确保所有修改的代码均包含中文函数级注释，并遵循 Vue 3 最佳实践。

### 🛠️ Agent 终端助手详情页独立化与视觉重构 (2026-01-13)
- **Agent 专题页独立化**:
  - **架构调整**: 将 Agent 详情页从 `AppLayout` 的子路由中移出，变为与首页平级的顶层路由。现在访问 `/agent` 将呈现完全独立的 Landing Page 风格，提供沉浸式阅读体验。
  - **视觉一致性**: 采用与首页一致的现代设计语言，包含渐变文字、毛玻璃效果、以及流畅的滚动入场动画。
  - **交互增强**: 专题页现已具备完整的移动端适配和主题切换功能，并新增了模拟终端的实时演示。
  - **内容优化**: 移除了所有平台特定的下载限制说明，采用统一的路由引导，让用户更直观地了解 Agent 的核心功能与使用方法。

### 🛠️ 欢迎页与精美 UI 交互 (2026-01-12)
- **全新欢迎页 (Landing Page)**:
  - **精美视觉设计**: 设计了全新的根路径 `/` 欢迎页面，采用沉浸式 Hero 区域、渐变文字、毛玻璃导航栏以及流畅的入场动画。
  - **核心特性展示**: 通过卡片化布局直观展示了 AI 问答、个人云盘、语言学习三大核心功能，并配有对应的功能清单。
  - **实时交互演示**: 增加了一个模拟 AI 对话的实时打字机动画，让用户进入网站的第一秒就能感知 AI 助手的魅力。
  - **全局主题适配**: 欢迎页完美支持深色/浅色模式切换，并保持了全站 UI 风格的高度统一。
  - **响应式布局**: 针对移动端、平板和桌面端进行了深度适配，确保在任何设备上都有极致的视觉呈现。
  - **无缝导航引导**: 提供了清晰的登录、注册以及“以游客身份试用”的行动导向按钮（CTA），大幅提升了转化率和用户留存。

### 🛠️ 游客功能与后端内存优化 (2026-01-12)
- **后端内存占用优化**:
  - **线程池重构**: 为 AI 聊天和后台任务引入了专用线程池 `chatExecutor` 和 `backgroundExecutor`，解决了高并发下线程频繁创建销毁导致的内存抖动问题。
  - **分页历史加载**: 将聊天记录从“全量加载”优化为“分页加载”，并限制了模型上下文的字符数，有效防止了长对话导致的 OOM（内存溢出）风险。
  - **流式文件处理**: 优化了云盘文件操作，采用流式读写替代全量读取到内存，极大降低了处理大文件时的瞬时内存峰值。
- **游客模式 (免登录访问)**:
  - **匿名对话支持**: 允许用户无需登录即可直接进入聊天页面进行 AI 对话，提供流畅的试用体验。
  - **频率限制 (Rate Limiting)**: 针对游客（IP 维度）实施了对话频率限制，每日限额 5 次对话，通过 Redis 进行高效计数。
  - **角色化导航**: 根据登录状态动态调整侧边栏导航，游客仅可访问“AI 问答”和“公共资源”，云盘、语言学习等私有功能自动隐藏。
  - **匿名记录保存**: 游客的对话记录根据 Session ID 和 IP 地址保存在专门的 `anonymous_chat_records` 表中，确保数据隔离。
  - **会话平滑升级**: 游客在聊天过程中会收到登录提示，引导其注册以保存永久历史记录。
- **功能细节优化**:
  - 路由守卫调整: 放开了 `/chat` 和 `/public-files` 路由的认证要求。
  - **公共资源开放**: 游客现在可以访问公共资源列表并直接下载文件，无需登录。后端 Security 已配置允许对 `/api/public-files` 及其子路径的 GET 请求进行匿名访问。
  - 前端状态管理: `chatStore` 支持在未登录状态下发起请求，并自动处理后端返回的匿名 Session ID。
  - **UI 交互改进**: 侧边栏为游客增加了明显的登录引导提示，优化了未登录状态下的头像显示。

### 🛠️ 多语言翻译与语言学习模块导航优化 (2026-01-10)
- **新增多语言翻译功能**:
  - 后端新增 `TranslationController` 和 `TranslationService`，集成 `AiChatService` 实现高质量 AI 翻译。
  - 支持中文、英语、日语、韩语、法语、德语、西班牙语、俄语等 8 种语言互译。
  - 前端开发了 `TranslationTool.vue` 组件，支持语言切换、一键复制和文本互换功能。
  - 翻译功能已集成至“语言学习”模块中，方便用户在学习过程中随时翻译。
  - 修复了翻译请求中目标语言可能为空导致的验证失败问题，增加了默认目标语言支持。
   - 移除了控制器中的 `@Valid` 验证，解决了因热部署未完全刷新 DTO 验证规则导致的请求拦截问题。
    - 优化了 AI 翻译的 Prompt 结构，引入 `System Prompt` 提高了翻译的专业性并解决了后台“系统提示词为空”的警告。
    - 移除了前端翻译成功时的冗余 `alert` 提示，优化了用户交互体验。
  - **修复翻译结果不显示问题**: 修正了前端 `TranslationTool.vue` 对后端成功响应的判定逻辑，从 `response.success` 更改为 `response.code === 200`，确保翻译内容能正确渲染到译文区域。
  - **优化后台日志**: 清理了 `AiChatServiceImpl` 中对系统提示词的误报警告，使后台日志输出更加清晰准确。
- **语言学习模块导航重构**:
  - 将原有的页内侧边栏迁移至全局 `AppSidebar`，统一了全站导航风格。
  - 实现了基于路由查询参数（Query Parameters）的视图切换逻辑，支持在侧边栏直接切换“学习概览”、“我的生词”、“公共词库”、“AI 文章”和“智能翻译”。
  - 优化了侧边栏子导航的视觉样式，增加了活动状态指示器，并与聊天记录列表风格保持一致。
- **移动端适配优化**:
  - 移除了语言学习页面冗余的移动端头部和侧边栏遮罩，解决了与全局布局的显示冲突。
  - 优化了全局侧边栏在移动端的交互，确保在切换子导航视图时自动关闭侧边栏，提升了小屏设备的可用性。

### 🛠️ 用户注册与个人资料修复 (2026-01-10)
- **修复用户名不匹配问题**:
  - 解决了注册时输入的用户名未被正确保存的问题（原逻辑错误地使用了邮箱前缀作为用户名）。
  - 在 `RegisterRequest` DTO 中增加了 `username` 字段及相应的参数校验。
  - 更新了 `AuthService` 中的注册逻辑，优先使用用户输入的用户名创建账号。
- **新增个人资料编辑功能**:
  - 在后端 `UserController` 中新增了 `updateProfile` 接口，支持用户修改自己的用户名。
  - 在前端 `Settings.vue` 页面增加了用户名编辑入口，支持“点击编辑-保存-取消”交互。
  - 更新了 `auth.js` store，实现了资料更新后的本地缓存同步更新，确保 UI 实时反馈。

### 🛠️ AI 对话逻辑简化 (2026-01-10)
- **移除 Agent 循环**:
  - 取消了所有基于 Agent 循环的工具调用和任务自动更新逻辑，回归纯粹的普通对话模式。
  - 移除了 `AiChatService` 中的 `askAgentStream` 接口，统一使用 `askStream` 进行流式问答。
  - 清理了不再使用的 `ToolsService`、`ToolCallParser` 等相关类和方法，减少了系统复杂度。
  - 优化了对话核心实现，移除了不必要的 JSON 解析和任务上下文维护逻辑，提升了响应速度。
- **上下文与 UI 优化**:
  - **取消上下文窗口限制**: 移除了对话历史消息数量的限制（MAX_CONTEXT_MESSAGES），现在 AI 可以保留并引用全部历史对话内容。
  - **UI 图标移除**: 移除了 AI 生成内容时的“深度思考”脑部图标及闪烁光标，以匹配图 2 的极简设计风格。
- **配置安全性增强**:
  - 对 `application.yml` 中的 DeepSeek 和 豆包 API Key 进行了 Jasypt 加密处理。
  - 支持通过环境变量 `JASYPT_ENCRYPTOR_PASSWORD` 注入解密密钥，避免敏感信息明文泄露。

### 🛠️ 管理后台文件预览与下载修复 (2026-01-06)
- **PDF & 图片预览修复**:
  - 修复了 PDF 预览显示“获取内容失败”的问题，通过在前端请求中添加 `transformResponse: [(data) => data]` 成功获取并解析了原始 Blob 数据。
  - 优化了预览弹窗的视觉效果，增加了磨砂玻璃背景、加载动画和更清晰的错误提示信息。
  - 解决了 PDF 预览时 iframe 边框显示不协调的问题，使预览效果更加沉浸。
- **Word 下载体验优化**:
  - 修复了 Word 文件在弹窗中文字布局混乱的问题，增加了专门的文件信息展示区域。
  - 确保了管理员可以跨用户安全地下载所有类型的文件。
- **接口稳定性增强**:
  - 将管理员下载接口路径统一调整为 `/api/admin/files/download/{fileId}`，与内容获取接口保持一致。
  - 增加了后端日志记录，支持在文件下载过程中实时追踪文件路径解析状态，便于后续排错。
  - 增强了前端对 Blob 错误响应的解析能力，现在可以正确显示后端返回的 JSON 格式错误信息。

### 🛠️ 管理后台 UI 优化与文件预览增强 (2026-01-06)
- **管理后台 UI 深度优化**:
  - 重构了用户管理、文件管理和反馈管理的表格样式，增加了交互动画和响应式适配。
  - 优化了搜索框、下拉选择框的视觉效果，使其更符合现代化 UI 规范。
  - 改进了操作按钮的视觉反馈，区分了“预览”、“编辑”和“查看”等不同功能场景。
- **全格式文件查看支持**:
  - **PDF & 图片预览**: 实现了基于 Blob 对象的安全预览功能，支持在管理后台直接查看 PDF 文件和各类图片格式（JPG, PNG, GIF）。
  - **Word 文件处理**: 针对 Word (.doc/.docx) 文件，添加了“下载查看”功能，并优化了文件下载流程。
  - **文本文件编辑**: 优化了文本类文件的加载状态显示，增强了编辑器的容错处理。
- **后端管理接口加固**:
  - 在 `AdminController` 中新增了管理员专用的文件下载/预览接口，绕过了普通用户的路径限制。
  - 在 `CloudDiskService` 中实现了 `downloadFileAdmin` 方法，支持管理员跨用户下载和预览文件。
  - 完善了 API 端点配置，确保前后端在管理功能上的高度同步。

### 🛠️ 管理后台功能增强 (2026-01-06)
- **搜索与筛选功能增强**:
  - 在“文件管理”选项卡添加了**用户筛选下拉框**，支持直接点击选择特定用户查看其文件。
  - 在“用户管理”列表添加了**“查看文件”快捷按钮**，点击即可跳转并自动筛选该用户的文件。
  - 优化了搜索框布局，支持文件名实时过滤，提升了管理大批量文件的效率。
  - 优化了管理后台的交互体验，增加了空数据状态的友好提示。
- **文件管理显示修复**:
  - 修复了 `AdminView.vue` 中文件管理、用户管理和反馈管理等选项卡数据无法显示的问题。
  - 修正了前端在解析后端 `ApiResponse` 统一包装类时的路径错误，统一使用 `response.data` 获取业务数据。
  - 修复了后端 `AdminController` 中的 `LazyInitializationException` 问题，通过在 `UserFileRepository` 中使用 `JOIN FETCH` 优化查询，确保关联的用户数据能被正确加载。
  - 增强了统计卡片的展示稳定性，确保在数据加载失败时显示默认值。
- **管理后台交互优化**:
  - 修复了文件编辑弹窗中文件内容无法加载的问题。
  - 优化了管理后台各模块的数据刷新逻辑，确保在切换标签页时能够实时获取最新数据。

### 🚀 公共资源下载与管理后台增强 (2026-01-06)
- **公共资源下载修复**: 
  - 解决了下载公共文件时可能触发前端路由跳转而非浏览器下载的问题。
  - 通过 `encodeURIComponent` 处理文件名，并在前端强制使用新窗口打开下载链接，提升了不同浏览器下的兼容性。
- **管理后台数据统计修复**:
  - 修复了管理员仪表盘统计数据全为 0 的问题，通过在后端 `AdminStatistics` 实体中添加 `@JsonProperty` 注解，确保了前后端数据字段映射的一致性。
- **API 配置自动化**:
  - 优化了 `api.js` 中的 `getBaseURL` 逻辑，能够根据当前域名自动切换 `localhost:5000` 或生产环境相对路径，简化了前后端分离部署的配置。
  - 完善了公共资源的 API 端点配置，包括上传、列表、下载和删除功能。
- **删除功能增强**: 
  - 在公共资源页面为管理员增加了文件删除功能，并实现了前后端联动实时刷新。
  - 后端实现了 `DELETE /api/public-files/{filename}` 接口，支持物理文件删除。

### 🛡️ 管理员设置与界面滚动优化 (2026-01-05)
- **管理员自动化设置**:
  - 新增了 `UserService.setAsAdmin` 事务性方法，支持将指定邮箱账号设置为管理员。
  - 引入了 `CommandLineRunner` 机制（`adminSetupRunner`），在应用启动时自动将指定账号（如 `3301767269@qq.com`）配置为管理员。
  - 增强了认证系统：在 JWT Token 中新增了 `is_admin` Claim，使前端能够实时感知用户的管理员身份。
- **数据库架构加固 (Flyway)**:
  - 引入了 `V2_2__fix_admin_table_defaults.sql` 迁移文件，通过存储过程安全地为 `admins` 表的 `is_active` 和 `is_superadmin` 字段添加了数据库级别的默认值（1 和 0）。
  - 解决了 `SQL Error 1364: Field 'is_active' doesn't have a default value` 报错，确保管理员记录在各种插入场景下的稳定性。
- **全屏滚动体验优化**:
  - 统一修复了全站页面的滚动失效问题。核心方案是将各子页面的 `height: 100vh` 或固定计算高度修改为 `height: 100%`，并由父容器 `AppLayout` 统一管理滚动条。
  - **云盘页 (CloudDiskView)**: 修复了长文件列表无法下滑的问题。
  - **聊天页 (ChatView)**: 修复了消息历史过长时的滚动异常。
  - **设置页 (SettingsView)**: 解决了设置选项过多时无法滑动查看底部内容的问题。
  - **管理页 (AdminView & ChatManagementView)**: 移除了 `AdminView` 和 `ChatManagementView` 中冗余嵌套的 `AppLayout` 组件，修复了双重布局导致的滚动冲突和样式错乱。
  - **布局系统加固**: 在 `AppLayout.vue` 的 `main-content` 容器中增加了 `min-height: 0` 配置，解决了 Flex 布局下子元素无法正确触发内部滚动的经典难题。
- **前端界面精简**:
  - 移除了聊天工具栏中暂不可用的功能图标（截图、通话、语音输入），提升了界面的整洁度和用户体验。
- **敏感配置加密 (Jasypt)**: 
  - 集成了 **Jasypt** 加密框架，对 `application.yml` 中的数据库密码、邮件授权码、DeepSeek API Key 等敏感信息进行了加密处理（`ENC(...)` 格式）。
  - 支持通过环境变量 `JASYPT_PASSWORD` 动态传入解密盐值。

### 🌐 生产环境部署与数据库兼容性优化 (2026-01-05)
- **域名自动识别**: 前端配置现在能够自动识别 `aistudy.icu` 域名并切换后端基础地址到 `http://aistudy.icu:5000`。
- **CORS 与安全修复**: 
  - 更新了后端 CORS 白名单，允许来自 `aistudy.icu` 的跨域请求。
  - 修复了 Spring Security 导致的 OPTIONS 预检请求返回 403 Forbidden 的问题。
- **多环境配置支持**: 引入了 `application-dev.yml` 和 `application-prod.yml`，支持通过 `--spring.profiles.active=prod` 参数切换环境。
- **数据库版本管理**: 引入了 **Flyway** 数据库迁移工具，支持自动版本控制和基准线 (`baseline`) 迁移。

### 🔐 找回密码与认证功能修复 (2026-01-05)
- **参数映射修复**: 修复了 `ResetPasswordRequest` 中 JSON 字段无法正确映射的问题。
- **错误响应规范化**: 更新了 `GlobalExceptionHandler`，将验证失败的返回格式统一为 `ErrorResponse` 对象。
- **验证码系统校准**: 打通了发送重置码、验证并更新密码的完整流程。

### 🔧 工具批准系统修复 (2025-12-25)
- **前端设置保存**: 修复了用户在前端设置工具批准规则后未保存到后端的问题。
- **批准同步**: 确保用户批准/拒绝工具调用时正确同步到后端。
- **数据一致性**: 统一了前端和后端的工具名称映射关系。

### 🛠️ 后端管理与文件编辑增强 (2025-12-24)
- **AdminController**: 新增管理员专用控制器，支持全站统计、用户管理及文件列表查询。
- **全格式文件编辑**: 支持对多种文本格式（如 `.js`, `.ts`, `.java`, `.py` 等）的直接编辑。
- **编码兼容性优化**: 修复了读取非 UTF-8 编码文件（如 GBK）时的报错问题。
- **存储统计修复**: 修复了管理员面板中全站总存储空间的统计逻辑。

### 🎨 前端 AI 终端系统全面重构 (2025-12-24)
- **AgentLoopManager**: 完整的 Agent 循环生命周期管理器。
- **CheckpointTimeline**: 时间旅行式检查点可视化。
- **ToolApprovalManager**: 智能工具批准系统。
- **SessionStatePanel**: 实时会话状态监控。
- **UI 交互优化**: 将任务链移至右侧面板，采用更紧凑的聊天框样式，提升了核心内容展示空间。
