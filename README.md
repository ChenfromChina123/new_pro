# AI智能学习助手系统 - Vue 3版本

这是基于Vue 3的现代化前端重构版本，将原有的HTML页面转换为组件化的Vue应用。

## ✨ 特性

- 🚀 **Vue 3 + Vite** - 使用最新的Vue 3 Composition API和Vite构建工具
- 🎨 **现代化UI** - 全新的界面设计，支持深色模式
- 📦 **组件化开发** - 模块化的组件结构，易于维护和扩展
- 🔐 **完整的认证系统** - JWT Token认证，路由守卫
- 💾 **状态管理** - 使用Pinia进行全局状态管理
- 🌐 **API集成** - 完整对接后端FastAPI接口
- 📱 **响应式设计** - 适配各种屏幕尺寸

## 🛠️ 技术栈

- **框架**: Vue 3.4+
- **构建工具**: Vite 5.0+
- **路由**: Vue Router 4.2+
- **状态管理**: Pinia 2.1+
- **HTTP客户端**: Axios 1.6+
- **Markdown渲染**: Marked 11.0+
- **代码高亮**: Highlight.js 11.9+

## 🚀 最近更新

### ☁️ 云盘功能增强
- **目录层级限制**: 云盘最多支持两层目录（不计根目录），在后端和前端均实现了严格的验证逻辑。
- **存储配额管理**: 实现了用户存储配额限制（普通用户 1GB，管理员无限制），并在上传文件前进行校验。
- **存储空间可视化**: 在侧边栏实时显示当前用户的存储空间使用情况和配额进度条。修复了由于后端数据结构兼容性或零值验证导致的 0 B/0 B 显示问题，现在能够正确反映已用空间大小。
- **路径导航优化**: 修复了面包屑路径显示不全的问题，现在正确显示完整的文件夹层级（如 `123 > 写作`），并自动隐藏根节点以简化显示。
- **UI 交互升级**: 将文件夹操作按钮合并为悬浮显示的选项卡，仅在鼠标悬停时平滑显示；优化了文件夹树的点击高亮逻辑。
- **导航稳定性修复**: 解决了点击云盘时组件切换不稳定的问题，通过为路由视图添加唯一 `key`、引入 `onActivated` 生命周期钩子以及优化侧边栏监听逻辑，确保了多任务场景下的无缝切换。

### 🤖 AI 问答体验优化
- **全屏布局重构**: 采用 100vh 全屏布局，侧边栏固定高度，提供沉浸式交互体验。
- **输入框 UI 重构**: 现代化大圆角设计，集成附件上传、模型切换、截图、语音等丰富工具栏。
- **滚动逻辑优化**: 修复了聊天内容滚动不准确的问题。现在通过 `setTimeout` 和 `triggerScrollToBottom` 助手函数，确保在会话切换、页面刷新以及 DOM 完全渲染（包含数学公式）后，能够准确、可靠地滚动到消息列表最底部。
- **深度思考 (Reasoning)**: 支持 DeepSeek Reasoner 等推理模型，实现思考过程的流式展示与智能收起逻辑。
- **智能会话增强**: 引入后端并行调用 DeepSeek 功能。现在在用户发起的**每一条**消息后，都会自动、异步地生成简短的会话标题（仅限首条）和 3 条相关的建议引导问题。
- **引导问题视角优化**: 调整了建议问题的生成逻辑，强制使用**用户口吻**提出追问（避免“我可以为你…”等 AI 口吻），并要求以问号结尾，提升交互代入感。
- **交互式建议问题**: 前端支持实时显示生成的建议问题，用户点击建议即可快速发送，极大提升了对话启动效率和引导体验。
- **引导问题稳定性**: 后端对建议问题做去重、清洗与兜底补全，确保解析失败或格式异常时仍能稳定返回 3 条问题。
- **侧边栏状态同步**: 修复了新建对话后左侧聊天列表未及时刷新的问题，确保会话状态在全平台实时同步。
- **停止生成功能**: 支持通过 AbortController 中止 SSE 流式输出。
- **响应式字体**: 优化了聊天消息的字体大小和间距，提升长文本阅读体验。
- **内容布局优化**: 聊天内容的宽度现在被限制为与输入框一致（max-width: 980px），并居中显示。当遇到代码块、表格等大尺寸内容时，会自动转换为可左右拉伸（横向滚动）的容器，确保排版整洁且不影响阅读。
- **代码块复制优化**: 重新设计了代码块右上角的复制按钮。现在采用精致的半透明磨砂玻璃效果，并增加了 FontAwesome 图标支持。按钮默认隐藏，仅在鼠标悬停在代码块上时平滑显示，并提供“已复制”成功反馈和动态图标切换，极大提升了代码复用体验。
- **AI 输出长度增强**: 将豆包（Doubao）等模型的最大输出 token 限制从 4096 提升至 8192，支持生成更详尽、更完整的长文本内容。

### 🧩 交互稳定性
- **页面切换修复**: 彻底解决了从“语言学习”模块切换至其他模块（如 AI 问答、云盘）时页面显示空白的问题。
  - **组件结构优化**: 将 `LanguageLearningView.vue` 从多根节点（Fragment）重构为单根节点，修复了 Vue `<transition>` 动画在组件切换时的渲染异常。
  - **生命周期管理**: 移除了全局 `keep-alive` 并优化了事件监听器的绑定与销毁逻辑，消除了组件间的状态冲突与资源泄露。

### 🛡️ 代码质量与安全
- **XSS 安全防护**: 全面集成 `DOMPurify` 库对 `v-html` 内容进行过滤，有效防御跨站脚本攻击。
- **Lombok 注解优化**: 为实体类字段添加 `@Builder.Default`，确保数据模型在 Builder 模式下的正确初始化。
- **后端框架稳定性**: 将 Spring Boot 降级至 3.3.5，修复了与 Spring Cloud Function 的依赖冲突导致的启动失败问题。
- **CSS 兼容性修复**: 完善了 `line-clamp` 等 CSS 属性的浏览器兼容性写法，确保多行文本截断在各端显示一致。
- **代码清理**: 移除了后端多个 Service 和 Controller 中未使用的导入和变量，修复了重复定义的局部变量，提升了系统性能与可维护性。
- **消息字段兼容**: 前端拉取历史消息时兼容后端 `send_time/ai_model` 字段回填，确保时间与模型展示一致。

## 📦 安装

### 前置要求

- Node.js 16+ 或 20+
- npm 或 yarn

### 安装步骤

1. **克隆项目**

```bash
cd Aiproject8.2/vue-app
```

2. **安装依赖**

```bash
npm install
# 或
yarn install
```

3. **配置环境变量**

项目会自动使用代理将 `/api` 请求转发到 `http://localhost:5000`

如需修改后端地址，可编辑 `vite.config.js`:

```javascript
server: {
  port: 3000,
  proxy: {
    '/api': {
      target: 'http://your-backend-url:5000',
      changeOrigin: true
    }
  }
}
```

## 🚀 运行

### 开发模式

```bash
npm run dev
```

应用将在 `http://localhost:3000` 启动

### 生产构建

```bash
npm run build
```

构建文件将输出到 `dist` 目录

### 预览生产构建

```bash
npm run preview
```

## 📁 项目结构

```
vue-app/
├── src/
│   ├── assets/              # 静态资源
│   │   └── styles/          # 全局样式
│   │       └── main.css     # 主样式文件
│   ├── components/          # 通用组件
│   │   ├── AppHeader.vue    # 顶部导航栏
│   │   ├── AppLayout.vue    # 基础布局
│   │   └── Sidebar/         # 侧边栏组件
│   ├── views/               # 页面视图
│   │   ├── ChatView.vue     # AI 问答页面
│   │   └── CloudDiskView.vue # 云盘页面
│   ├── stores/              # Pinia 状态管理
│   └── config/              # 配置文件
```
