# AI ç³»ç»Ÿé‡æ„æ€»ç»“

## ğŸ“‹ é¡¹ç›®ä¿¡æ¯
- **å®Œæˆæ—¥æœŸ**ï¼š2025-12-23
- **é¡¹ç›®åç§°**ï¼šAISpring AI ç»ˆç«¯ç³»ç»Ÿé‡æ„
- **å‚è€ƒé¡¹ç›®**ï¼šVoid-Main (VS Code Fork)

---

## ğŸ“š æ–‡æ¡£æ¸…å•

### 1. Void-Main AI æœºåˆ¶æ·±åº¦è§£æ
**æ–‡ä»¶**ï¼š`VOID_MAIN_AI_MECHANISM_ANALYSIS.md`

**å†…å®¹æ¦‚è§ˆ**ï¼š
- âœ… ç³»ç»Ÿæ¶æ„æ¦‚è§ˆï¼ˆè¿›ç¨‹é€šä¿¡æ¨¡å‹ã€æœåŠ¡å±‚è®¾è®¡ï¼‰
- âœ… æ ¸å¿ƒæœåŠ¡å±‚è®¾è®¡ï¼ˆä¾èµ–æ³¨å…¥ã€äº‹ä»¶é©±åŠ¨ï¼‰
- âœ… èŠå¤©çº¿ç¨‹ç®¡ç†æœºåˆ¶ï¼ˆæ•°æ®ç»“æ„ã€æ¶ˆæ¯ç±»å‹ç³»ç»Ÿï¼‰
- âœ… Agent å¾ªç¯ä¸å·¥å…·è°ƒç”¨ï¼ˆæ ¸å¿ƒé€»è¾‘ã€æ‰¹å‡†æœºåˆ¶ï¼‰
- âœ… å·¥å…·ç³»ç»Ÿæ¶æ„ï¼ˆ12 ä¸ªå†…ç½®å·¥å…·ã€å‚æ•°éªŒè¯ï¼‰
- âœ… LLM æ¶ˆæ¯æµæ§åˆ¶ï¼ˆIPC é€šé“ã€æµå¼å“åº”ï¼‰
- âœ… æ£€æŸ¥ç‚¹ä¸æ—¶é—´æ—…è¡Œï¼ˆæ•°æ®ç»“æ„ã€è·³è½¬é€»è¾‘ï¼‰
- âœ… çŠ¶æ€ç®¡ç†ä¸æŒä¹…åŒ–ï¼ˆå­˜å‚¨å±‚æŠ½è±¡ã€æ¢å¤æœºåˆ¶ï¼‰
- âœ… æ ¸å¿ƒè®¾è®¡æ¨¡å¼ï¼ˆ9 ç§è®¾è®¡æ¨¡å¼è¯¦è§£ï¼‰
- âœ… ä¸ Spring Boot åç«¯çš„å¯¹æ¯”

**å…³é”®äº®ç‚¹**ï¼š
- **æ¶æ„æ¸…æ™°**ï¼šå›¾æ–‡å¹¶èŒ‚ï¼ŒåŒ…å«æ¶æ„å›¾ã€æµç¨‹å›¾ã€çŠ¶æ€è½¬æ¢å›¾
- **ä»£ç ç¤ºä¾‹**ï¼šæä¾› TypeScript ä¼ªä»£ç ï¼Œæ˜“äºç†è§£
- **è®¾è®¡æ¨¡å¼**ï¼šæ·±å…¥è§£æå•ä¸€æ•°æ®æºã€ä¸å¯å˜æ•°æ®ã€ä¾èµ–æ³¨å…¥ç­‰æ¨¡å¼

---

### 2. AISpring AI ç»ˆç«¯ç³»ç»Ÿé‡æ„æŒ‡å—
**æ–‡ä»¶**ï¼š`AISPRING_AI_TERMINAL_REFACTOR_GUIDE.md`

**å†…å®¹æ¦‚è§ˆ**ï¼š
- âœ… é‡æ„èƒŒæ™¯ä¸ç›®æ ‡ï¼ˆ7 å¤§ç—›ç‚¹ + 6 å¤§ç›®æ ‡ï¼‰
- âœ… å½“å‰ç³»ç»Ÿåˆ†æï¼ˆæ¶æ„å›¾ã€æ ¸å¿ƒç±»åˆ†æã€å‰ç«¯æµç¨‹ï¼‰
- âœ… æ ¸å¿ƒæ”¹è¿›æ–¹æ¡ˆï¼ˆæ•´ä½“æ¶æ„ã€çŠ¶æ€æœºè®¾è®¡ï¼‰
- âœ… æ•°æ®åº“è®¾è®¡ï¼ˆ4 å¼ æ–°è¡¨ + Redis å­˜å‚¨ï¼‰
- âœ… åç«¯æ¶æ„é‡æ„ï¼ˆ5 ä¸ªæ ¸å¿ƒæœåŠ¡ + è¯¦ç»†å®ç°ï¼‰
- âœ… å‰ç«¯æ¶æ„é‡æ„ï¼ˆå®Œæ•´çš„ Vue ç»„ä»¶ä»£ç ï¼‰
- âœ… å·¥å…·ç³»ç»Ÿå¢å¼ºï¼ˆå‚æ•°éªŒè¯ + ç»“æœæ ¼å¼åŒ–ï¼‰
- âœ… æ£€æŸ¥ç‚¹ç³»ç»Ÿå®ç°ï¼ˆæ’¤é”€/é‡åšé€»è¾‘ï¼‰
- âœ… æ‰¹å‡†æœºåˆ¶è®¾è®¡ï¼ˆ4 ç±»å·¥å…·æ‰¹å‡†ï¼‰
- âœ… ä¸­æ–­æœºåˆ¶ä¼˜åŒ–ï¼ˆç»Ÿä¸€ä¸­æ–­æ¥å£ï¼‰
- âœ… å®æ–½è·¯çº¿å›¾ï¼ˆ6 ä¸ªé˜¶æ®µï¼Œ10 å‘¨è®¡åˆ’ï¼‰
- âœ… æµ‹è¯•ç­–ç•¥ï¼ˆå•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯•ï¼‰
- âœ… é£é™©è¯„ä¼°ä¸ç¼“è§£ï¼ˆ7 ç±»é£é™© + åº”å¯¹æªæ–½ï¼‰

**å…³é”®äº®ç‚¹**ï¼š
- **å³æ’å³ç”¨**ï¼šæä¾›å®Œæ•´çš„ Java ä»£ç å’Œ Vue ä»£ç ï¼Œå¯ç›´æ¥ä½¿ç”¨
- **è¯¦ç»†è·¯çº¿å›¾**ï¼šæŒ‰å‘¨æ‹†åˆ†ä»»åŠ¡ï¼Œæ¸…æ™°çš„å®æ–½è®¡åˆ’
- **é£é™©ç®¡ç†**ï¼šæå‰è¯†åˆ«æ½œåœ¨é—®é¢˜ï¼Œæä¾›ç¼“è§£æªæ–½

---

## ğŸ¯ æ ¸å¿ƒæ”¹è¿›ç‚¹

### 1. çŠ¶æ€ç®¡ç†
**ç°çŠ¶**ï¼š`AgentState` ä¸ `ChatRecord` åˆ†ç¦»ï¼ŒçŠ¶æ€åŒæ­¥å›°éš¾

**æ”¹è¿›**ï¼š
- å¼•å…¥ `SessionState`ï¼ˆç»Ÿä¸€çŠ¶æ€ç®¡ç†ï¼‰
- å¼•å…¥ `StreamState`ï¼ˆç»†ç²’åº¦æµå¼çŠ¶æ€ï¼‰
- Redis å­˜å‚¨ï¼ˆåˆ†å¸ƒå¼æ”¯æŒ + 24 å°æ—¶ TTLï¼‰

### 2. æ£€æŸ¥ç‚¹ç³»ç»Ÿ
**ç°çŠ¶**ï¼šæ— æ£€æŸ¥ç‚¹ï¼Œæ— æ³•æ’¤é”€ AI æ“ä½œ

**æ”¹è¿›**ï¼š
- è‡ªåŠ¨åˆ›å»ºæ£€æŸ¥ç‚¹ï¼ˆç”¨æˆ·æ¶ˆæ¯å‰ã€å·¥å…·ç¼–è¾‘å‰ï¼‰
- æ”¯æŒæ—¶é—´æ—…è¡Œï¼ˆè·³è½¬åˆ°ä»»æ„æ£€æŸ¥ç‚¹ï¼‰
- ç”¨æˆ·ä¿®æ”¹è¿½è¸ªï¼ˆåŒºåˆ† AI ä¿®æ”¹å’Œç”¨æˆ·ä¿®æ”¹ï¼‰
- æ•°æ®åº“å­˜å‚¨ï¼ˆJSON æ ¼å¼ï¼‰

### 3. å·¥å…·æ‰¹å‡†æœºåˆ¶
**ç°çŠ¶**ï¼šå‰ç«¯ç›´æ¥æ‰§è¡Œæ‰€æœ‰å·¥å…·ï¼Œå­˜åœ¨å®‰å…¨é£é™©

**æ”¹è¿›**ï¼š
- å·¥å…·åˆ†ç±»æ‰¹å‡†ï¼ˆå±é™©å·¥å…·ã€æ–‡ä»¶ç¼–è¾‘ã€MCP å·¥å…·ç­‰ï¼‰
- ç”¨æˆ·å¯é…ç½®è‡ªåŠ¨æ‰¹å‡†è§„åˆ™
- æ‰¹å‡†/æ‹’ç»çš„ UI äº¤äº’ï¼ˆ`ToolApprovalDialog.vue`ï¼‰
- æ•°æ®åº“è®°å½•æ‰¹å‡†å†å²

### 4. Agent å¾ªç¯
**ç°çŠ¶**ï¼šä»…æ”¯æŒä»»åŠ¡æµæ°´çº¿ï¼Œå¾ªç¯é€»è¾‘ç®€é™‹

**æ”¹è¿›**ï¼š
- é€šç”¨ Agent å¾ªç¯ï¼ˆä¸ä¾èµ–ä»»åŠ¡æµæ°´çº¿ï¼‰
- è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼ˆLLM è°ƒç”¨å¤±è´¥æ—¶æœ€å¤šé‡è¯• 3 æ¬¡ï¼‰
- ç»†ç²’åº¦çŠ¶æ€ç®¡ç†ï¼ˆSTREAMING_LLM, RUNNING_TOOL, AWAITING_USER, IDLEï¼‰
- æœ€å¤§å¾ªç¯æ¬¡æ•°é™åˆ¶ï¼ˆ10 æ¬¡ï¼‰

### 5. å·¥å…·ç³»ç»Ÿ
**ç°çŠ¶**ï¼šå‚æ•°éªŒè¯è–„å¼±ï¼Œç»“æœæ ¼å¼åŒ–ä¸ç»Ÿä¸€

**æ”¹è¿›**ï¼š
- ä¸¥æ ¼çš„å‚æ•°éªŒè¯ï¼ˆç±»å‹ã€èŒƒå›´ã€æ ¼å¼ï¼‰
- è¯¦ç»†çš„é”™è¯¯æç¤ºï¼ˆå‘Šè¯‰ AI å“ªé‡Œå‡ºé”™äº†ï¼‰
- ç»Ÿä¸€çš„ç»“æœæ ¼å¼åŒ–ï¼ˆæ”¯æŒåˆ†é¡µã€é”™è¯¯æç¤ºã€Lint é”™è¯¯ï¼‰
- å·¥å…·æ‰§è¡Œç»“æœçš„å¯ä¸­æ–­æ€§

### 6. ä¸­æ–­æœºåˆ¶
**ç°çŠ¶**ï¼šLLM å¯ä¸­æ–­ï¼Œä½†å·¥å…·æ‰§è¡Œæ— æ³•ä¸­æ–­

**æ”¹è¿›**ï¼š
- ç»Ÿä¸€ä¸­æ–­æ¥å£ï¼ˆ`/api/agent/interrupt`ï¼‰
- ä¸ºæ¯ä¸ª Agent å¾ªç¯ç”Ÿæˆå”¯ä¸€ `loopId`
- åœ¨å¾ªç¯ä¸­å®šæœŸæ£€æŸ¥ä¸­æ–­æ ‡å¿—
- ä¸­æ–­åçš„çŠ¶æ€æ¸…ç†

### 7. å‰ç«¯ä½“éªŒ
**ç°çŠ¶**ï¼šUI ç®€é™‹ï¼Œç¼ºå°‘æ‰¹å‡†ã€ä¸­æ–­ã€æ£€æŸ¥ç‚¹ç­‰äº¤äº’

**æ”¹è¿›**ï¼š
- æ‰¹å‡† UIï¼ˆ`ToolApprovalDialog.vue`ï¼‰
- ä¸­æ–­æŒ‰é’®ï¼ˆå®æ—¶æ˜¾ç¤º Agent çŠ¶æ€ï¼‰
- æ£€æŸ¥ç‚¹æ—¶é—´çº¿ï¼ˆ`CheckpointTimeline.vue`ï¼‰
- è®¾ç½®å¯¹è¯æ¡†ï¼ˆ`SettingsDialog.vue`ï¼‰
- æµå¼å†…å®¹ä¼˜åŒ–ï¼ˆæ‰“å­—æœºæ•ˆæœã€æ¨ç†å†…å®¹æŠ˜å ï¼‰

---

## ğŸ“Š æŠ€æœ¯æ ˆå¯¹æ¯”

| ç»´åº¦ | Void-Main | AISpringï¼ˆå½“å‰ï¼‰ | AISpringï¼ˆé‡æ„åï¼‰ |
|------|-----------|------------------|---------------------|
| **è¯­è¨€** | TypeScript | Java | Java |
| **æ¡†æ¶** | Electron + VSCode DI | Spring Boot | Spring Boot |
| **å‰ç«¯** | React (TSX) | Vue 3 | Vue 3 |
| **çŠ¶æ€ç®¡ç†** | å†…å­˜ + IStorageService | å†…å­˜ (ConcurrentHashMap) | Redis + MySQL |
| **æ¶ˆæ¯é€šä¿¡** | IPC Channel (Event-driven) | HTTP + SSE | HTTP + SSE + WebSocket |
| **æ£€æŸ¥ç‚¹** | âœ… åµŒå…¥æ¶ˆæ¯å†å² | âŒ æ—  | âœ… æ•°æ®åº“å­˜å‚¨ |
| **å·¥å…·æ‰¹å‡†** | âœ… å¯é…ç½® | âŒ æ—  | âœ… å¯é…ç½® |
| **ä¸­æ–­æœºåˆ¶** | âœ… ç»Ÿä¸€æ¥å£ | âš ï¸ ä¸å®Œæ•´ | âœ… ç»Ÿä¸€æ¥å£ |
| **å‚æ•°éªŒè¯** | âœ… ä¸¥æ ¼éªŒè¯ | âš ï¸ è–„å¼± | âœ… ä¸¥æ ¼éªŒè¯ |

---

## ğŸš€ å®æ–½è®¡åˆ’ï¼ˆ10 å‘¨ï¼‰

### Phase 1ï¼šæ•°æ®åº“ä¸åŸºç¡€è®¾æ–½ï¼ˆWeek 1-2ï¼‰
```sql
-- åˆ›å»º chat_checkpoints è¡¨
CREATE TABLE chat_checkpoints (...);

-- åˆ›å»º tool_approvals è¡¨
CREATE TABLE tool_approvals (...);

-- åˆ›å»º user_approval_settings è¡¨
CREATE TABLE user_approval_settings (...);

-- æ‰©å±• chat_records è¡¨
ALTER TABLE chat_records ADD COLUMN checkpoint_id VARCHAR(64);
ALTER TABLE chat_records ADD COLUMN loop_id VARCHAR(64);
```

**Redis é…ç½®**ï¼š
```yaml
spring:
  redis:
    host: localhost
    port: 6379
    database: 1
    timeout: 2000ms
```

### Phase 2ï¼šæ ¸å¿ƒæœåŠ¡å¼€å‘ï¼ˆWeek 3-4ï¼‰
```java
// 1. SessionStateServiceï¼ˆRedis å­˜å‚¨ï¼‰
@Service
public class SessionStateServiceImpl implements SessionStateService {
    @Autowired
    private RedisTemplate<String, SessionState> redisTemplate;
    // ...
}

// 2. AgentLoopServiceï¼ˆæ ¸å¿ƒ Agent å¾ªç¯ï¼‰
@Service
public class AgentLoopServiceImpl implements AgentLoopService {
    public String runAgentLoop(String sessionId, Long userId, String userMessage) { ... }
    public void approveAndRunTool(String sessionId, Long userId, String decisionId) { ... }
    public void rejectTool(String sessionId, Long userId, String decisionId) { ... }
    public void interruptLoop(String loopId) { ... }
}

// 3. CheckpointServiceï¼ˆæ£€æŸ¥ç‚¹ä¸æ—¶é—´æ—…è¡Œï¼‰
@Service
public class CheckpointServiceImpl implements CheckpointService {
    public String createCheckpoint(...) { ... }
    public void jumpToCheckpoint(...) { ... }
}

// 4. ToolValidationServiceï¼ˆå‚æ•°éªŒè¯ï¼‰
@Service
public class ToolValidationService {
    public Map<String, Object> validateParams(String toolName, Map<String, Object> rawParams) { ... }
    public String formatResult(String toolName, ToolResult result) { ... }
}

// 5. ToolApprovalServiceï¼ˆæ‰¹å‡†æœºåˆ¶ï¼‰
@Service
public class ToolApprovalService {
    public boolean checkIfNeedApproval(String toolName, Map<String, Object> params, Long userId) { ... }
    public ToolApproval createApprovalRequest(...) { ... }
}
```

### Phase 3ï¼šController å±‚ï¼ˆWeek 5ï¼‰
```java
@RestController
@RequestMapping("/api/agent")
public class AgentController {
    @PostMapping("/chat")
    public ApiResponse<String> chat(@RequestBody ChatRequest request) { ... }
    
    @PostMapping("/approve-tool")
    public ApiResponse<Void> approveTool(@RequestBody ApprovalRequest request) { ... }
    
    @PostMapping("/reject-tool")
    public ApiResponse<Void> rejectTool(@RequestBody RejectionRequest request) { ... }
    
    @PostMapping("/interrupt")
    public ApiResponse<Void> interrupt(@RequestBody InterruptRequest request) { ... }
    
    @PostMapping("/jump-to-checkpoint")
    public ApiResponse<Void> jumpToCheckpoint(@RequestBody JumpRequest request) { ... }
    
    @GetMapping("/stream")
    public SseEmitter stream(@RequestParam String sessionId) { ... }
}
```

### Phase 4ï¼šå‰ç«¯é‡æ„ï¼ˆWeek 6-7ï¼‰
```vue
<!-- 1. AgentTerminalView.vueï¼ˆä¸»è§†å›¾ï¼‰ -->
<template>
  <div class="agent-terminal">
    <div class="terminal-header">...</div>
    <div class="messages-container">...</div>
    <div class="input-container">...</div>
  </div>
</template>

<!-- 2. ToolApprovalDialog.vueï¼ˆæ‰¹å‡†å¯¹è¯æ¡†ï¼‰ -->
<template>
  <div class="approval-dialog">
    <h3>å·¥å…·è°ƒç”¨è¯·æ±‚æ‰¹å‡†</h3>
    <div class="tool-info">
      <strong>å·¥å…·åç§°ï¼š</strong>{{ toolName }}
      <strong>å‚æ•°ï¼š</strong><pre>{{ JSON.stringify(toolParams, null, 2) }}</pre>
    </div>
    <div class="actions">
      <button @click="$emit('approve')">æ‰¹å‡†</button>
      <button @click="$emit('reject')">æ‹’ç»</button>
    </div>
  </div>
</template>

<!-- 3. CheckpointTimeline.vueï¼ˆæ£€æŸ¥ç‚¹æ—¶é—´çº¿ï¼‰ -->
<template>
  <div class="checkpoint-timeline">
    <div v-for="checkpoint in checkpoints" :key="checkpoint.id" class="checkpoint-item">
      <div class="checkpoint-marker"></div>
      <div class="checkpoint-label">{{ checkpoint.type }} - {{ checkpoint.createdAt }}</div>
      <button @click="$emit('jump', checkpoint.id)">è·³è½¬</button>
    </div>
  </div>
</template>

<!-- 4. SettingsDialog.vueï¼ˆè®¾ç½®å¯¹è¯æ¡†ï¼‰ -->
<template>
  <div class="settings-dialog">
    <h3>æ‰¹å‡†è®¾ç½®</h3>
    <div class="setting-item">
      <input type="checkbox" v-model="settings.autoApproveDangerousTools" />
      <label>è‡ªåŠ¨æ‰¹å‡†å±é™©å·¥å…·ï¼ˆåˆ é™¤ã€æ‰§è¡Œå‘½ä»¤ï¼‰</label>
    </div>
    <!-- æ›´å¤šè®¾ç½® -->
  </div>
</template>
```

### Phase 5ï¼šæµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆWeek 8ï¼‰
```java
// å•å…ƒæµ‹è¯•
@SpringBootTest
public class AgentLoopServiceTest {
    @Test
    public void testRunAgentLoop() { ... }
    @Test
    public void testApproveAndRunTool() { ... }
    @Test
    public void testInterruptLoop() { ... }
}

// é›†æˆæµ‹è¯•
@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)
@AutoConfigureMockMvc
public class AgentControllerIntegrationTest {
    @Test
    @WithMockUser(username = "testuser")
    public void testChatStream() { ... }
}
```

### Phase 6ï¼šæ–‡æ¡£ä¸éƒ¨ç½²ï¼ˆWeek 9-10ï¼‰
- Swagger API æ–‡æ¡£
- ç”¨æˆ·æ‰‹å†Œï¼ˆå«æˆªå›¾ï¼‰
- éƒ¨ç½²è„šæœ¬ï¼ˆDocker Composeï¼‰
- æ•°æ®è¿ç§»å·¥å…·

---

## ğŸ”‘ å…³é”®è®¾è®¡æ¨¡å¼åº”ç”¨

### 1. å•ä¸€æ•°æ®æº (Single Source of Truth)
```java
// âŒ é”™è¯¯ï¼šç›´æ¥ä¿®æ”¹
AgentState state = agentStateService.getAgentState(sessionId, userId);
state.setStatus(AgentStatus.RUNNING); // å±é™©ï¼

// âœ… æ­£ç¡®ï¼šé€šè¿‡ Service æ–¹æ³•
agentStateService.updateStatus(sessionId, userId, AgentStatus.RUNNING);
```

### 2. ä¸å¯å˜æ•°æ® (Immutability)
```java
// âœ… æ­£ç¡®ï¼šä¸å¯å˜æ›´æ–°
SessionState newState = SessionState.builder()
    .sessionId(oldState.getSessionId())
    .userId(oldState.getUserId())
    .status(AgentStatus.RUNNING) // æ›´æ–°å­—æ®µ
    .streamState(oldState.getStreamState())
    .taskState(oldState.getTaskState())
    .build();
```

### 3. ä¾èµ–æ³¨å…¥ (Dependency Injection)
```java
@Service
public class AgentLoopServiceImpl implements AgentLoopService {
    private final SessionStateService sessionStateService;
    private final LLMService llmService;
    private final ToolValidationService toolValidationService;
    
    @Autowired
    public AgentLoopServiceImpl(
        SessionStateService sessionStateService,
        LLMService llmService,
        ToolValidationService toolValidationService
    ) {
        this.sessionStateService = sessionStateService;
        this.llmService = llmService;
        this.toolValidationService = toolValidationService;
    }
}
```

### 4. çŠ¶æ€æœºæ¨¡å¼ (State Machine)
```java
public enum AgentStatus {
    IDLE,              // ç©ºé—²
    RUNNING,           // è¿è¡Œä¸­
    AWAITING_APPROVAL, // ç­‰å¾…æ‰¹å‡†
    PAUSED,            // æš‚åœ
    COMPLETED,         // å®Œæˆ
    ERROR              // é”™è¯¯
}

// çŠ¶æ€è½¬æ¢éªŒè¯
public void transitionTo(AgentStatus newStatus) {
    if (!isValidTransition(this.status, newStatus)) {
        throw new IllegalStateException(
            String.format("Invalid transition: %s -> %s", this.status, newStatus)
        );
    }
    this.status = newStatus;
}
```

### 5. ç­–ç•¥æ¨¡å¼ (Strategy Pattern)
```java
public interface ToolExecutor {
    ToolResult execute(Map<String, Object> params);
}

public class ExecuteCommandTool implements ToolExecutor {
    @Override
    public ToolResult execute(Map<String, Object> params) {
        String command = (String) params.get("command");
        // æ‰§è¡Œå‘½ä»¤...
        return ToolResult.success(stdout, stderr, exitCode);
    }
}

// å·¥å…·æ³¨å†Œ
Map<String, ToolExecutor> toolExecutors = Map.of(
    "execute_command", new ExecuteCommandTool(),
    "read_file", new ReadFileTool(),
    "write_file", new WriteFileTool()
);
```

---

## âš ï¸ å¸¸è§é™·é˜±ä¸æœ€ä½³å®è·µ

### é™·é˜± 1ï¼šçŠ¶æ€åŒæ­¥é—®é¢˜
**é—®é¢˜**ï¼šRedis å’Œ MySQL çŠ¶æ€ä¸ä¸€è‡´

**è§£å†³æ–¹æ¡ˆ**ï¼š
- Redis ä½œä¸ºç¼“å­˜ï¼ŒMySQL ä½œä¸ºæŒä¹…åŒ–å­˜å‚¨
- æ¯æ¬¡æ›´æ–° Redis åï¼Œå¼‚æ­¥å†™å…¥ MySQL
- å¯åŠ¨æ—¶ä» MySQL æ¢å¤çŠ¶æ€åˆ° Redis

### é™·é˜± 2ï¼šSSE è¿æ¥æ³„æ¼
**é—®é¢˜**ï¼šå‰ç«¯é¡µé¢å…³é—­åï¼ŒSSE è¿æ¥æœªå…³é—­

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨ `onUnmounted` é’©å­å…³é—­ EventSource
- åç«¯å®šæœŸæ¸…ç†è¶…æ—¶çš„ SseEmitterï¼ˆè¶…è¿‡ 5 åˆ†é’Ÿæœªæ´»åŠ¨ï¼‰

### é™·é˜± 3ï¼šæ£€æŸ¥ç‚¹æ•°æ®é‡è¿‡å¤§
**é—®é¢˜**ï¼šæ¯ä¸ªæ£€æŸ¥ç‚¹å­˜å‚¨å®Œæ•´æ–‡ä»¶å†…å®¹ï¼Œå ç”¨å¤§é‡ç©ºé—´

**è§£å†³æ–¹æ¡ˆ**ï¼š
- é™åˆ¶æ£€æŸ¥ç‚¹ä¿ç•™æ•°é‡ï¼ˆæœ€å¤š 50 ä¸ªï¼Œè¶…è¿‡è‡ªåŠ¨åˆ é™¤æœ€æ—©çš„ï¼‰
- ä»…å­˜å‚¨æ–‡ä»¶å·®å¼‚ï¼ˆä½¿ç”¨ diff ç®—æ³•ï¼‰
- å‹ç¼© JSON æ•°æ®ï¼ˆä½¿ç”¨ GZIPï¼‰

### é™·é˜± 4ï¼šAgent å¾ªç¯æ­»é”
**é—®é¢˜**ï¼šLLM æŒç»­è¿”å›å·¥å…·è°ƒç”¨ï¼Œå¯¼è‡´æ— é™å¾ªç¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
- è®¾ç½®æœ€å¤§å¾ªç¯æ¬¡æ•°ï¼ˆ10 æ¬¡ï¼‰
- è¶…æ—¶æœºåˆ¶ï¼ˆå•æ¬¡å¾ªç¯æœ€å¤š 3 åˆ†é’Ÿï¼‰
- å¾ªç¯è®¡æ•°å™¨å‘ŠçŸ¥ AIï¼ˆå¦‚ï¼š"è¿™æ˜¯ç¬¬ 5 æ¬¡å¾ªç¯ï¼Œè¯·å°½å¿«å®Œæˆä»»åŠ¡"ï¼‰

### é™·é˜± 5ï¼šå·¥å…·æ‰§è¡Œè¶…æ—¶
**é—®é¢˜**ï¼šæŸäº›å‘½ä»¤ï¼ˆå¦‚ `npm install`ï¼‰æ‰§è¡Œæ—¶é—´å¾ˆé•¿

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä¸ºæ¯ä¸ªå·¥å…·è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
- æä¾›è¿›åº¦å›è°ƒï¼ˆå¦‚ï¼š"æ­£åœ¨å®‰è£…ä¾èµ–... 50%"ï¼‰
- æ”¯æŒåå°æ‰§è¡Œï¼ˆç”¨æˆ·å¯ç»§ç»­å¯¹è¯ï¼‰

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. Redis ç¼“å­˜ç­–ç•¥
```java
// è¯»å–æ—¶å…ˆæŸ¥ Redisï¼Œæœªå‘½ä¸­å†æŸ¥ MySQL
public SessionState getSessionState(String sessionId, Long userId) {
    String key = String.format("session:state:%s", sessionId);
    SessionState state = redisTemplate.opsForValue().get(key);
    
    if (state == null) {
        // ä» MySQL åŠ è½½
        state = sessionRepository.findBySessionIdAndUserId(sessionId, userId)
            .orElse(SessionState.newIdle(sessionId, userId));
        
        // å†™å…¥ Redis
        redisTemplate.opsForValue().set(key, state, Duration.ofHours(24));
    }
    
    return state;
}
```

### 2. æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
```sql
-- chat_checkpoints è¡¨
CREATE INDEX idx_session_user ON chat_checkpoints(session_id, user_id);
CREATE INDEX idx_message_order ON chat_checkpoints(session_id, message_order);

-- tool_approvals è¡¨
CREATE INDEX idx_session_user ON tool_approvals(session_id, user_id);
CREATE INDEX idx_decision ON tool_approvals(decision_id);
CREATE INDEX idx_status ON tool_approvals(approval_status);

-- chat_records è¡¨ï¼ˆç°æœ‰è¡¨æ‰©å±•ï¼‰
CREATE INDEX idx_checkpoint ON chat_records(checkpoint_id);
CREATE INDEX idx_loop ON chat_records(loop_id);
```

### 3. SSE è¿æ¥æ± ç®¡ç†
```java
@Component
public class SseEmitterManager {
    private final Map<String, SseEmitter> emitters = new ConcurrentHashMap<>();
    
    public void register(String sessionId, SseEmitter emitter) {
        emitters.put(sessionId, emitter);
        
        // è®¾ç½®è¶…æ—¶å›è°ƒ
        emitter.onTimeout(() -> emitters.remove(sessionId));
        emitter.onCompletion(() -> emitters.remove(sessionId));
    }
    
    public void send(String sessionId, String eventType, Object data) {
        SseEmitter emitter = emitters.get(sessionId);
        if (emitter != null) {
            try {
                emitter.send(SseEmitter.event()
                    .name(eventType)
                    .data(data));
            } catch (IOException e) {
                emitters.remove(sessionId);
            }
        }
    }
}
```

### 4. å‰ç«¯æ€§èƒ½ä¼˜åŒ–
```javascript
// ä½¿ç”¨ requestAnimationFrame èŠ‚æµ SSE æ›´æ–°
let pendingUpdate = null;

eventSource.addEventListener('stream_update', (event) => {
  const data = JSON.parse(event.data);
  
  if (pendingUpdate === null) {
    pendingUpdate = requestAnimationFrame(() => {
      streamState.value = data;
      pendingUpdate = null;
    });
  }
});
```

---

## ğŸ‰ æ€»ç»“

### æœ¬æ¬¡é‡æ„è§£å†³çš„æ ¸å¿ƒé—®é¢˜
1. âœ… **çŠ¶æ€ç®¡ç†æ··ä¹±** â†’ ç»Ÿä¸€çš„ `SessionState` + Redis å­˜å‚¨
2. âœ… **æ— æ£€æŸ¥ç‚¹ç³»ç»Ÿ** â†’ å®Œæ•´çš„æ£€æŸ¥ç‚¹ä¸æ—¶é—´æ—…è¡ŒåŠŸèƒ½
3. âœ… **å·¥å…·æ— æ‰¹å‡†æœºåˆ¶** â†’ 4 ç±»å·¥å…·æ‰¹å‡† + ç”¨æˆ·å¯é…ç½®
4. âœ… **ä¸­æ–­ä¸å®Œæ•´** â†’ ç»Ÿä¸€ä¸­æ–­æ¥å£ + ä¸­æ–­æ ‡å¿—æ£€æŸ¥
5. âœ… **å¾ªç¯é€»è¾‘ç®€é™‹** â†’ é€šç”¨ Agent å¾ªç¯ + è‡ªåŠ¨é‡è¯•
6. âœ… **å·¥å…·ç»“æœæ ¼å¼åŒ–ä¸ç»Ÿä¸€** â†’ ç»Ÿä¸€æ ¼å¼åŒ– + è¯¦ç»†é”™è¯¯æç¤º
7. âœ… **å‚æ•°éªŒè¯è–„å¼±** â†’ ä¸¥æ ¼éªŒè¯ + å‹å¥½é”™è¯¯æ¶ˆæ¯

### é¢„æœŸæ•ˆæœ
- **å®‰å…¨æ€§æå‡**ï¼šå·¥å…·æ‰¹å‡†æœºåˆ¶é˜²æ­¢å±é™©æ“ä½œ
- **å¯é æ€§æå‡**ï¼šæ£€æŸ¥ç‚¹ç³»ç»Ÿæ”¯æŒæ’¤é”€é”™è¯¯æ“ä½œ
- **ç”¨æˆ·ä½“éªŒæå‡**ï¼šä¸­æ–­æœºåˆ¶ã€æ‰¹å‡† UIã€æ£€æŸ¥ç‚¹æ—¶é—´çº¿
- **ä»£ç è´¨é‡æå‡**ï¼šæ¸…æ™°çš„æœåŠ¡å±‚ã€ä¸¥æ ¼çš„å‚æ•°éªŒè¯
- **å¯ç»´æŠ¤æ€§æå‡**ï¼šè¯¦ç»†çš„æ–‡æ¡£ã€å®Œæ•´çš„æµ‹è¯•

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨
1. **ç«‹å³å¼€å§‹**ï¼šPhase 1ï¼ˆæ•°æ®åº“è®¾è®¡ï¼‰
2. **å¿«é€Ÿè¿­ä»£**ï¼šæŒ‰ç…§ 10 å‘¨è®¡åˆ’é€æ­¥å®æ–½
3. **æŒç»­ä¼˜åŒ–**ï¼šæ ¹æ®ç”¨æˆ·åé¦ˆè°ƒæ•´åŠŸèƒ½
4. **æ‰©å±•ç”Ÿæ€**ï¼šæ”¯æŒ MCP å·¥å…·ã€è‡ªå®šä¹‰å·¥å…·

---

**ğŸ“ å­¦ä¹ èµ„æº**
- [Void-Main ä»£ç ä»“åº“](https://github.com/voideditor/void)
- [Spring Boot å®˜æ–¹æ–‡æ¡£](https://spring.io/projects/spring-boot)
- [Vue 3 å®˜æ–¹æ–‡æ¡£](https://vuejs.org/)
- [Redis å®˜æ–¹æ–‡æ¡£](https://redis.io/documentation)

**ğŸ“§ è”ç³»æ–¹å¼**
- å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒ `VOID_MAIN_AI_MECHANISM_ANALYSIS.md` å’Œ `AISPRING_AI_TERMINAL_REFACTOR_GUIDE.md`
- æŠ€æœ¯è®¨è®ºï¼šæŸ¥çœ‹é¡¹ç›® README.md

---

**æ–‡æ¡£ç»“æŸ**

ç¥é‡æ„é¡ºåˆ©ï¼ğŸš€

